FROM node:20-alpine AS build
WORKDIR /app
RUN chown node:node ./
COPY --chown=node:node package.json package-lock.json ./
USER node
RUN npm ci --legacy-peer-deps --no-fund --omit=optional --no-audit
COPY --chown=node:node . .
RUN npm run build

RUN chown root /usr/share/nginx/html/*
RUN chmod 755 /usr/share/nginx/html/*

COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
